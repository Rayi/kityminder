<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="title" content="百度脑图">
    <meta name="keyword" content="脑图,kity,svg,minder,百度,fex,前端,在线">
    <meta name="description" content="百度脑图，便捷的脑图编辑工具。让您在线上直接创建、保存并分享你的思路。">


    <script src="lib/jquery-2.1.0.min.js" charset="utf-8"></script>

    <script src="lib/kitygraph.all.js" charset="utf-8"></script>
    <script src="kityminder.all.js" charset="utf-8"></script>
    <script src="kityminder.config.js" charset="utf-8"></script>
    <script src="lang/zh-cn/zh-cn.js" charset="utf-8"></script>
    
    <script src="lib/zip.js" charset="utf-8"></script>
    <script>
        zip.inflateJSPath = 'lib/inflate.js';
    </script>

    <script src="lib/jquery.xml2json.js" charset="utf-8"></script>
   
    <link href="themes/default/css/import.css" type="text/css" rel="stylesheet" />
    
    <link rel="stylesheet" href="pan/pan.css">
    <script src="pan/minder.third.js" charset="utf-8"></script>
    <style>
        a.file {
            padding: 10px;
            text-decoration: underline;
            cursor: pointer;
        }
    </style>
</head>
<style>
</style>
<body>
    <div class="files">
        <a class="file" data-type="xmind" data-url="pan/test/xmind.xmind">XMind 格式</a>
        <a class="file" data-type="km" data-url="pan/test/km.km">KM 格式</a>
        <a class="file" data-type="mmap" data-url="pan/test/mindmanager.mmap">Mind Manager 格式</a>
        <a class="file" data-type="mm" data-url="pan/test/freemind.mm">Free Mind 格式</a>
        <a class="file" data-type="xmind" data-url="pan/test/xmind.broken.xmind">XMind 格式（损坏）</a>
        <a class="file" data-type="km" data-url="pan/test/km.broken.km">KM 格式（损坏）</a>
        <a class="file" data-type="mmap" data-url="pan/test/mindmanager.broken.mmap">Mind Manager 格式（损坏）</a>
        <a class="file" data-type="mm" data-url="pan/test/freemind.broken.mm">Free Mind 格式（损坏）</a>
    </div>

    <!--Dialog 模板-->
    <div class="km-dialog">
        <a class="close">X</a>
        <div class="loading">
            <div class="loading-progress">0%</div>
        </div>
        <div id="kity-minder"></div>
    </div>
</body>
<script>

    var $dialog = $('.km-dialog').hide(),
        $close = $dialog.find('.close')
        $loading = $dialog.find('.loading').hide(),
        $loadingProgress = $loading.find('.loading-progress');

    $close.click(function() {
        $dialog.hide();
    });

    $('.files').delegate('.file', 'click', function(){
        var url = $(this).attr('data-url');
        var type = $(this).data('type');

        $dialog.show();
        $loading.show();
        ///加上这一段
        function hasSVG(){ 
            SVG_NS = 'http://www.w3.org/2000/svg'; 
            return !!document.createElementNS && 
            !!document.createElementNS(SVG_NS, 'svg').createSVGRect; 
        }
        if(!hasSVG()){
            $loadingProgress.text('暂不支持低端浏览器');
            return false;
        }
        ///
        $loadingProgress.text('正在加载...');

        KityMinder.load({
            url: $(this).data('url'),
            type: $(this).data('type'),
            target: 'kity-minder',
            success: function(minder) {
                $loading.hide();
            },
            progress: function(percent) {
                $loadingProgress.text('正在加载（' + percent.toFixed(2) + '%）...')
            },
            error: function(message) {
                $loadingProgress.text('加载失败：' + message);
            }
        });
    });
</script>
</html>