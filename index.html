<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <!-- jquery 引用，如果页面已经有jquery，则不需要引用了 -->
    <script src="lib/jquery-2.1.0.min.js" charset="utf-8"></script>
    
    <!-- kity 库引用 -->
    <script src="kity/dist/kity.js" charset="utf-8"></script>

    <!-- canvg.js 用于绘制 svg 代码 -->
    <script src="lib/rgbcolor.js"></script>
    <script src="lib/canvg.js"></script>

    <!-- minder 代码引用 -->
    <script src="import.js" charset="utf-8"></script>

    <!-- 配置和语言 -->
    <script src="kityminder.config.js" charset="utf-8"></script>
    <script src="lang/zh-cn/zh-cn.js" charset="utf-8"></script>
    
    <!-- 皮肤引入 -->
    <link href="themes/wenku/css/wenku.css" type="text/css" rel="stylesheet" />
</head>

<body>
    <div id="dialog">
        <div class="dialog-title">思维导图</div>
        <div class="dialog-body">
            <div id="kityminder" onselectstart="return false"></div>
        </div>
        <div class="dialog-bottom">
            <button class="ok">确定</button>
        </div>
    </div>
</body>
<script>
    km = KM.getKityMinder('kityminder');
    km.initStyle();

    $('body').delegate('img', 'dblclick', function() {
        $('#dialog').show();
        km.importData($(this).attr('minderData'), 'json');
    });
    function outputImage() {
        km.removeAllSelectedNodes();
        km.exportData('base64').then(function(base64, width, height) {
            var json = km.exportData('json');
            var $img = $('<img>').appendTo('body').attr({
                width: width,
                height: height,
                src: base64,
                minderData: json
            });
            $('#dialog').hide();
        });
    }
    $('.ok').click(outputImage);
</script>
</html>